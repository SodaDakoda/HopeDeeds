<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Opportunity | HopeDeeds</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link rel="stylesheet" href="styles.css" />
  </head>

  <body class="bg-gray-50 text-gray-800">
    <header class="bg-white shadow">
      <div
        class="container mx-auto flex justify-between items-center py-4 px-6"
      >
        <h1 class="text-2xl font-bold text-blue-700">
          Hope<span class="text-orange-500">Deeds</span>
        </h1>
        <nav>
          <ul class="flex gap-4 items-center">
            <li><a href="organization_dashboard.html">Dashboard</a></li>
            <li>
              <a
                href="/org/logout"
                class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition"
              >
                Log Out
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container mx-auto py-10 px-6">
      <button
        onclick="window.history.back()"
        class="text-blue-600 hover:underline mb-4 inline-flex items-center gap-2"
      >
        <i class="fas fa-arrow-left"></i> Back to Details
      </button>

      <section
        class="bg-white shadow-md rounded-lg p-6 border-l-4 border-blue-500"
      >
        <h2 class="text-3xl font-bold mb-6">
          <i class="fas fa-edit text-blue-600"></i> Edit Opportunity
        </h2>

        <form id="edit-opportunity-form" class="space-y-4">
          <div>
            <label class="block font-semibold">Title</label>
            <input
              type="text"
              id="title"
              class="border p-2 rounded w-full"
              required
            />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block font-semibold">Area</label>
              <input
                type="text"
                id="area"
                class="border p-2 rounded w-full"
                placeholder="Kitchen, Warehouse..."
              />
            </div>
            <div>
              <label class="block font-semibold">Special Type</label>
              <input
                type="text"
                id="special_type"
                class="border p-2 rounded w-full"
                placeholder="Holiday, Event..."
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block font-semibold">Start Date</label>
              <input
                type="date"
                id="start_date"
                class="border p-2 rounded w-full"
              />
            </div>
            <div>
              <label class="block font-semibold">Start Time</label>
              <input
                type="time"
                id="start_time"
                class="border p-2 rounded w-full"
              />
            </div>
            <div>
              <label class="block font-semibold">End Time</label>
              <input
                type="time"
                id="end_time"
                class="border p-2 rounded w-full"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block font-semibold">Duration (hours)</label>
              <input
                type="number"
                id="duration"
                class="border p-2 rounded w-full"
                step="0.5"
              />
            </div>
            <div>
              <label class="block font-semibold">Max Capacity</label>
              <input
                type="number"
                id="max_capacity"
                class="border p-2 rounded w-full"
              />
            </div>
            <div>
              <label class="block font-semibold">Frequency</label>
              <select id="frequency_type" class="border p-2 rounded w-full">
                <option value="once">One-time</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
          </div>

          <div>
            <label class="block font-semibold">Recurs Until</label>
            <input
              type="date"
              id="recur_until"
              class="border p-2 rounded w-full"
            />
          </div>

          <div>
            <label class="block font-semibold">Description</label>
            <textarea
              id="description"
              rows="4"
              class="border p-2 rounded w-full"
              placeholder="Describe this opportunity..."
            ></textarea>
          </div>

          <div class="mt-6 flex gap-3">
            <button
              type="submit"
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            >
              <i class="fas fa-save"></i> Save Changes
            </button>
            <a
              href="organization_dashboard.html"
              class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"
              >Cancel</a
            >
          </div>
        </form>
      </section>
    </main>

    <script>
      async function loadOpportunity() {
        const id = new URLSearchParams(window.location.search).get("id");
        if (!id) return alert("Missing opportunity ID");

        const res = await fetch(`/api/opportunities/${id}`);
        const opp = await res.json();

        document.getElementById("title").value = opp.title || "";
        document.getElementById("area").value = opp.area || "";
        document.getElementById("special_type").value = opp.special_type || "";
        document.getElementById("start_date").value = opp.start_date
          ? opp.start_date.split("T")[0]
          : "";
        document.getElementById("start_time").value = opp.start_time || "";
        document.getElementById("end_time").value = opp.end_time || "";
        document.getElementById("duration").value = opp.duration || "";
        document.getElementById("max_capacity").value = opp.max_capacity || "";
        document.getElementById("frequency_type").value =
          opp.frequency_type || "once";
        document.getElementById("recur_until").value = opp.recur_until
          ? opp.recur_until.split("T")[0]
          : "";
        document.getElementById("description").value = opp.description || "";

        document
          .getElementById("edit-opportunity-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            const body = {
              title: document.getElementById("title").value,
              area: document.getElementById("area").value,
              special_type: document.getElementById("special_type").value,
              start_date: document.getElementById("start_date").value,
              start_time: document.getElementById("start_time").value,
              end_time: document.getElementById("end_time").value,
              duration: parseFloat(document.getElementById("duration").value),
              max_capacity: parseInt(
                document.getElementById("max_capacity").value
              ),
              frequency_type: document.getElementById("frequency_type").value,
              recur_until: document.getElementById("recur_until").value,
              description: document.getElementById("description").value,
            };

            const res = await fetch(`/api/opportunities/${id}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body),
            });

            if (res.ok) {
              alert("Opportunity updated successfully!");
              window.location.href = `opportunity_details.html?id=${id}`;
            } else {
              alert("Failed to update opportunity.");
            }
          });
      }

      document.addEventListener("DOMContentLoaded", loadOpportunity);
    </script>
  </body>
</html>
