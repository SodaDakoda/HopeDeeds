<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Shift | HopeDeeds</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body class="bg-gray-50 text-gray-800">
    <header class="bg-white shadow">
      <div
        class="container mx-auto flex justify-between items-center py-4 px-6"
      >
        <h1 class="text-2xl font-bold text-blue-700">
          Hope<span class="text-orange-500">Deeds</span> (Admin)
        </h1>
        <nav>
          <ul class="flex gap-4 items-center">
            <li><a href="admin_dashboard.html">Dashboard</a></li>
            <li>
              <a href="/org/logout" class="text-red-500 hover:underline"
                >Logout</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container mx-auto py-10 px-6">
      <button
        onclick="window.history.back()"
        class="text-blue-600 hover:underline mb-6 inline-flex items-center gap-2"
      >
        <i class="fas fa-arrow-left"></i> Back
      </button>

      <div
        class="bg-white shadow-md rounded-lg p-8 border-l-4 border-blue-500 max-w-3xl mx-auto"
      >
        <h2 class="text-3xl font-bold mb-6 text-blue-700">
          <i class="fas fa-edit text-blue-600"></i> Edit Shift
        </h2>

        <form id="edit-shift-form" class="grid grid-cols-1 gap-6">
          <div>
            <label class="font-semibold block mb-2">Title</label>
            <input
              type="text"
              id="title"
              class="w-full border border-gray-300 rounded px-4 py-2"
              required
            />
          </div>

          <div>
            <label class="font-semibold block mb-2">Area</label>
            <input
              type="text"
              id="area"
              class="w-full border border-gray-300 rounded px-4 py-2"
            />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-semibold block mb-2">Start Date</label>
              <input
                type="date"
                id="start_date"
                class="w-full border border-gray-300 rounded px-4 py-2"
                required
              />
            </div>
            <div>
              <label class="font-semibold block mb-2">Recur Until</label>
              <input
                type="date"
                id="recur_until"
                class="w-full border border-gray-300 rounded px-4 py-2"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-semibold block mb-2">Start Time</label>
              <input
                type="time"
                id="start_time"
                class="w-full border border-gray-300 rounded px-4 py-2"
                required
              />
            </div>
            <div>
              <label class="font-semibold block mb-2">End Time</label>
              <input
                type="time"
                id="end_time"
                class="w-full border border-gray-300 rounded px-4 py-2"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-semibold block mb-2">Duration (hours)</label>
              <input
                type="number"
                step="0.5"
                id="duration"
                class="w-full border border-gray-300 rounded px-4 py-2"
              />
            </div>
            <div>
              <label class="font-semibold block mb-2">Max Capacity</label>
              <input
                type="number"
                id="max_capacity"
                class="w-full border border-gray-300 rounded px-4 py-2"
              />
            </div>
          </div>

          <div>
            <label class="font-semibold block mb-2">Frequency Type</label>
            <select
              id="frequency_type"
              class="w-full border border-gray-300 rounded px-4 py-2"
            >
              <option value="">One-time</option>
              <option value="daily">Daily</option>
              <option value="weekday">Weekdays (Mon–Fri)</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly (e.g., 2nd Thursday)</option>
            </select>
          </div>

          <div>
            <label class="font-semibold block mb-2">Special Type</label>
            <input
              type="text"
              id="special_type"
              class="w-full border border-gray-300 rounded px-4 py-2"
            />
          </div>

          <div>
            <label class="font-semibold block mb-2">Description</label>
            <textarea
              id="description"
              class="w-full border border-gray-300 rounded px-4 py-2 h-24"
            ></textarea>
          </div>

          <button
            type="submit"
            class="bg-blue-600 text-white font-semibold py-3 rounded hover:bg-blue-700 transition"
          >
            <i class="fas fa-save"></i> Save Changes
          </button>
        </form>

        <p id="status-message" class="mt-4 text-sm text-gray-600"></p>
      </div>
    </main>

    <script>
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const form = document.getElementById("edit-shift-form");
      const status = document.getElementById("status-message");

      async function loadShift() {
        if (!id) {
          status.textContent = "Invalid shift ID.";
          form.style.display = "none";
          return;
        }

        try {
          const res = await fetch(`/api/opportunities/${id}`);
          if (!res.ok) throw new Error("Failed to load shift data.");
          const data = await res.json();

          // Fill form fields
          document.getElementById("title").value = data.title || "";
          document.getElementById("area").value = data.area || "";
          document.getElementById("start_date").value =
            data.start_date?.split("T")[0] || "";
          document.getElementById("start_time").value =
            data.start_time?.substring(0, 5) || "";
          document.getElementById("end_time").value =
            data.end_time?.substring(0, 5) || "";
          document.getElementById("duration").value = data.duration || "";
          document.getElementById("max_capacity").value =
            data.max_capacity || 10;
          document.getElementById("frequency_type").value =
            data.frequency_type || "";
          document.getElementById("recur_until").value =
            data.recur_until?.split("T")[0] || "";
          document.getElementById("special_type").value =
            data.special_type || "";
          document.getElementById("description").value = data.description || "";
        } catch (err) {
          console.error(err);
          status.textContent = "Error loading shift details.";
        }
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        status.textContent = "Updating shift...";

        const payload = {
          title: document.getElementById("title").value,
          area: document.getElementById("area").value,
          start_date: document.getElementById("start_date").value,
          start_time: document.getElementById("start_time").value,
          end_time: document.getElementById("end_time").value,
          duration: document.getElementById("duration").value,
          max_capacity: document.getElementById("max_capacity").value,
          frequency_type: document.getElementById("frequency_type").value,
          recur_until: document.getElementById("recur_until").value,
          special_type: document.getElementById("special_type").value,
          description: document.getElementById("description").value,
        };

        try {
          const res = await fetch(`/api/opportunities/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          if (!res.ok) throw new Error("Failed to update shift");
          status.textContent = "✅ Shift updated successfully!";
          setTimeout(() => {
            window.location.href = `opportunity_profile.html?id=${id}`;
          }, 1000);
        } catch (err) {
          console.error(err);
          status.textContent = "❌ Error updating shift.";
        }
      });

      document.addEventListener("DOMContentLoaded", loadShift);
    </script>
  </body>
</html>
